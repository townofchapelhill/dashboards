<!DOCTYPE HTML>
<html>

<head>
   <!-- The libraries needed to make the pie charts in 3d -->
   <script src="https://code.highcharts.com/highcharts.js"></script>
   <script src="https://code.highcharts.com/highcharts-3d.js"></script>
   <script src="https://code.highcharts.com/modules/exporting.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>

<body>
   <!-- Containers to hold our pie charts -->
   <div id="container" style="height: 400px"></div>
   <div id="container2" style="height: 400px"></div>
   <div id="container3" style="height: 400px"></div>
   <div id="container4" style="height: 400px"></div>


   <script type="text/javascript">
      //get API json
      $.getJSON('https://www.chapelhillopendata.org/api/records/1.0/search/?dataset=ts_dashboard_test&rows=1000&apikey=0f36dcd81171f4408301b87c9afc8f8e1294f744eafa61a0dbda3ea4&callback=?', function(data) {

         //To hold our JSON data after we've parsed it into highcharts format
         var chartData = [];

         //Loops through our data and formats it for high charts, stores into chartData array
         for (var i = 0; i < data.records.length; i++) {
            chartData.push([data.records[i].fields.description, data.records[i].fields['2017_revised_budget']]);
         }

         //Creates our first pie chart
         Highcharts.chart('container', {
            chart: {
            //For 3d, must be enabled to true
               type: 'pie',
               options3d: {
                  enabled: true,
                  alpha: 45,
                  beta: 0
               }
            },
            title: {
               text: '2017 Revised Budget'
            },
            tooltip: {
               pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
               pie: {
                  allowPointSelect: true,
                  cursor: 'pointer',
                  //Depth of a slice must be set to a number for it to look 3d
                  depth: 35,
                  dataLabels: {
                     enabled: true,
                     format: '{point.name}'
                  }
               }
            },
            series: [{
               type: 'pie',
               name: 'Budget',
               colorByPoint: true,
               data: chartData
            }]
         });
         
         //TO CREATE OUR SECOND PIE CHART
         //To hold our JSON data after we've parsed it into highcharts format
         var chartData2 = [];
   
         //Loops through our data and formats it for high charts, stores into chartData array
         for (var i = 0; i < data.records.length; i++) {
            chartData2.push([data.records[i].fields.description, data.records[i].fields['2017_actual']])
         }
   
         Highcharts.chart('container2', {
            chart: {
               type: 'pie',
               options3d: {
                  enabled: true,
                  alpha: 45,
                  beta: 0
               }
            },
            title: {
               text: '2017 Actual Budget'
            },
            tooltip: {
               pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
               pie: {
                  allowPointSelect: true,
                  cursor: 'pointer',
                  depth: 35,
                  dataLabels: {
                     enabled: true,
                     format: '{point.name}',
                     style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                     }
                  }
               }
            },
            series: [{
               name: 'Budget',
               colorByPoint: true,
               data: chartData2
            }]
         });
         
         //TO CREATE OUR THIRD PIE CHART
         //To hold our JSON data after we've parsed it into highcharts format
         var chartData3 = [];
   
         //Loops through our data and formats it for high charts, stores into chartData array
         for (var i = 0; i < data.records.length; i++) {
            chartData3.push([data.records[i].fields.description, data.records[i].fields['2017_encumbrances']])
         }
   
         Highcharts.chart('container3', {
            chart: {
               type: 'pie',
               options3d: {
                  enabled: true,
                  alpha: 45,
                  beta: 0
               }
            },
            title: {
               text: '2017 Encumbrances'
            },
            tooltip: {
               pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
               pie: {
                  allowPointSelect: true,
                  cursor: 'pointer',
                  depth: 35,
                  dataLabels: {
                     enabled: true,
                     format: '{point.name}',
                     style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                     }
                  }
               }
            },
            series: [{
               type: 'pie',
               name: 'Budget',
               colorByPoint: true,
               data: chartData3
            }]
         });
         
         //TO CREATE OUR FOURTH PIE CHART
         //To hold our JSON data after we've parsed it into highcharts format
         var chartData4 = [];
   
         //Loops through our data and formats it for high charts, stores into chartData array
         for (var i = 0; i < data.records.length; i++) {
            chartData4.push([data.records[i].fields.description, data.records[i].fields['2017_available']]);
         }
   
         Highcharts.chart('container4', {
            chart: {
               type: 'pie',
               options3d: {
                  enabled: true,
                  alpha: 45,
                  beta: 0
               }
            },
            title: {
               text: '2017 Available'
            },
            tooltip: {
               pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
               pie: {
                  allowPointSelect: true,
                  cursor: 'pointer',
                  depth: 35,
                  dataLabels: {
                     enabled: true,
                     format: '{point.name}',
                     style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                     }
                  }
               }
            },
            series: [{
               name: 'Budget',
               colorByPoint: true,
               data: chartData4
            }]
         });
      });
   </script>

</body>

</html>